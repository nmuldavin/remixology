{% extends 'cocktails/base.html' %}

{% load staticfiles %}
{% load widget_tweaks %}

{% block headfirst %}{% endblock %}

{% block headlast %}
  <link rel="stylesheet" type="text/css" href="{% static 'cocktails/css/recipe_page.css' %}">

{% endblock %}

{% block title %}New Cocktail{% endblock %}

{% block bodyblock %}
    <form id="cocktail_form" method="post" action="/cocktails/addcocktail/">
      {% csrf_token %}
      {{ cocktail_form.non_field_errors }}
      {% for hidden in cocktail_form.hidden_fields %}
        {{ hidden }}
      {% endfor %}
      <h1 id="groupname">
        {{ cocktail_form.name|add_class:"form_inherit char_field"|attr:"placeholder:Cocktail Name"}}
      </h1>

      {{ cocktail_form.name.errors }}

      <p id="groupdescription">
        {{ cocktail_form.description.errors }}
        {{ cocktail_form.description|add_class:"form_inherit char_field"|attr:"rows:2"|attr:"placeholder:Short Description"}}
      </p>
      <div id="recipe_container">
        {% with 'cocktails/inner_recipe_form.html' as template %}
          {% include template %}
        {% endwith %}
      </div>
      <input type="submit" name="submit" value="Create Category" />
    </form>


{% endblock %}

{% block scripts %}
<script>

function incrementIndices() {

    var amounts = document.querySelectorAll(".recipe-entry .amount .char_field");
    var amount = amounts[amounts.length-1];

    var ingredients = document.querySelectorAll(".recipe-entry .ingredient .char_field");
    var ingredient = ingredients[ingredients.length-1];

    // Getting index from one of the strings, doesn't matter which one.

    var index = parseInt(amount.id.match(/(\d+)/g));
    index = index + 1;

    // replacing index in ids:
    var str = amount.id;
    amount.id = str.replace(/(\d+)/g, index);

    str = ingredient.id;
    ingredient.id = str.replace(/(\d+)/g, index);

    // replacing index in names:
    var string = amount.name;
    amount.name = str.replace(/(\d+)/g, index);

    str = ingredient.name;
    ingredient.name = str.replace(/(\d+)/g, index);

    var totalforms = document.getElementById('id_entry_formset-TOTAL_FORMS');
    var minforms = document.getElementById('id_entry_formset-MIN_NUM_FORMS');
    var number = parseInt(totalforms.value);
    number = number + 1;
    totalforms.value = String(number);
    minforms.value = String(number);

}

function formControlListeners() {
    $("#add_entry").click(function () {
        var newentry = $(".recipe-entry:last").clone();
        newentry.appendTo("#recipe-body");
        incrementIndices();
    });


    $("#remove_entry").click(function() {
        $(".recipe-entry:last").remove()
    })
}


$(document).ready(function() {
  formControlListeners();
});

</script>
{% endblock %}